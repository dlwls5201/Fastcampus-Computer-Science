# 프로세스와 스케쥴러의 이해 - 인터럽트

## 인터럽트란?

- CPU가 프로그램을 실행하고 있을 때, 입출력 하드웨어 등의 장치나 또는 예외상황이 발생하여 처리가 필요할 경우에 CPU에 알려서 처리하는 기술
> 어느 한순간에 CPU가 실행하는 명령은 하나!

## 인터럽트 필요한 이유

- 선점형 스케쥴러 구현
   - 프로세스 running 중에 스케쥴러가 이를 중단시키고, 다른 프로세스로 교체하기 위해, 현재 프로세스 실행을 중단시킴

- IO Device와싀 커뮤니케이션
   - 저장매체에서 데이터 처리 완료 시, 프로세스를 깨워야 함 (block state -> ready state)

- 예외 상황 핸들링
   - CPU가 프로그램을 실행하고 있을 때, 입출력 하드웨어 등의 장치나 또는 예외상황이 발생할 경우, CPU가 해당 처리를 할 수 있도록 CPU에게 알려줘야 함

## 주요 인터럽트

1. 계산하는 코드에서 0으로 나누는 코드 실행시
2. 타이머 인터럽트: 선점형 스케쥴러를 위해 필요
3. 입출력(IO) 인터럽트: 프린터, 키보드, 마우스, 저장매체(SSD등)

## 인터럽트 종류

- 내부 인터럽트는 주로 프로그램 내부에서 발생하므로, 소프트웨어 인터럽트라고 함
- 외부 인터럽트는 주로 하드웨어에서 발생하므로, 하드웨어 인터럽트라고 함

## 시스템 콜 인터럽트

- 시스템콜 실행을 위해서는 강제로 코드에 인터럽트 명령을 넣어 CPU에게 실행시켜야 한다.

## 인터럽트와 시스템 콜 순서

- 시스템콜 인터럽트 명령을 호출하면서 0x80값을 넘겨주는 경우
1. CPU는 사용자 모드를 커널 모드로 바꿔줌
2. IDT(Interrupt Descriptor Table)에서 0x80에 해당하는 주소(함수)를 찾아서 실행함
3. system_call() 함수에서 eax로부터 시스템 콜 번호를 찾아서, 해당 번호에 맞는 시스템콜 함수로 이동
4. 해당 시스템콜 함수 실행 후, 다시 커널 모드에서 사용자 모드로 변경하고, 다시 해당 프로세스 다음 코드 진행

## 인터럽트와 IDT

- 인터럽트는 미리 정의되어 각각 번호와 실행 코드를 가리키는 주소가 기록되어 있음
  - 어디에? IDT(Interrupt Descriptor Table)에 기록
  - 언제? 컴퓨터 부팅시 운영체제가 기록
  - 어떤 코드? 운영체제 내부 코드 (커널 모드/ 커널 영역)

- 리눅스의 예
  - 0 ~ 31 : 에외상황 인터럽트
  - 32 ~ 47 : 하드웨어 인터럽트
  - 128 : 시스템 콜 (0x80)
